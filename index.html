<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Wisdom</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA Metadata tags for iOS/Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ff7f00">
    
    <!-- FIX: Adding standard manifest link back. You must create this file on your server! -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* Custom Font and Body Styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Light cream background to match image */
            background-color: #fcfaf8; 
            display: flex;
            justify-content: center;
            /* Center the card vertically and horizontally */
            align-items: center; 
            min-height: 100vh;
            padding: 20px;
            /* Reset positioning from curved design */
            position: static; 
            overflow-x: hidden; 
        }
        /* Custom style for the article box */
        .article-box {
            line-height: 1.75; 
            border-radius: 8px; /* Added slight rounding for card feel */
        }
        /* Restore shadows and rounded corners for the main card */
        #app {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            background-color: white; /* Explicitly white card */
        }
    </style>
</head>
<body>
    <!-- Main Content Container (Restored to centered card layout) -->
    <div id="app" class="w-full max-w-xl mx-auto p-6 md:p-10">
        
        <!-- HEADER SECTION -->
        <div class="text-center mb-6 pt-4">
            <!-- Image Placeholder for Logo: 150x20 -->
            <img src="https://brsujit.github.io/messages/logo/kriya_logo.jpeg" 
                 alt="Kriya Yoga Logo Placeholder" 
                 class="mx-auto mb-2 block" 
                 style="height: 80px; width: 250px;">
            
            <!-- Main Title (Deep Orange) -->
            <h1 class="text-4xl font-extrabold text-[#ff7f00] tracking-wider mb-4">Messages from Masters</h1>
            
            <!-- THIN, WIDE, FAINT ORANGE LINE BELOW HEADER -->
            <div class="border-t border-amber-300 w-11/12 mx-auto"></div> 
        </div>

        <!-- Article/Quote Display Area -->
        <main id="article-container" class="min-h-[250px] flex flex-col items-center justify-center p-4 mt-4">
            
            <!-- Article Box Styled to match image (No left border) -->
            <div id="article-card" class="article-box bg-white p-6 md:p-8 w-full shadow-lg">
                
                <!-- Dynamic Article Title (Faint Orange) -->
                <h2 id="article-title" class="text-2xl font-bold text-amber-600 mb-4"></h2>
                
                <!-- Dynamic Article Content (Multi-paragraph) -->
                <div id="article-body" class="text-gray-700 text-base leading-relaxed space-y-4" style="line-height: 1.75;">
                    <p class="text-center text-gray-500">Loading daily message...</p>
                </div>

                <!-- MESSENGER NAME -->
                <p id="article-author" class="text-right text-base font-semibold text-amber-700 mt-4 italic"></p>
            </div>

            <!-- Error State -->
            <div id="error-message" class="hidden p-4 mt-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg w-full">
                <p>Error: Could not load messages data. The array is empty.</p>
            </div>
        </main>
        
        <!-- FOOTER BLOCK: Contains buttons and text -->
        <div class="mt-8 pt-4">
            
            <!-- THIN, WIDE, FAINT ORANGE LINE ABOVE BUTTONS -->
            <div class="border-t border-amber-300 w-11/12 mx-auto mb-6"></div> 
            
            <!-- Buttons (Thinned-out style applied) -->
            <div class="flex justify-center space-x-4 mb-0">
                <!-- Removed 'Next message' button -->
                <button id="install-button" class="hidden bg-[#ff7f00] hover:bg-amber-700 text-white font-semibold py-1 px-3 rounded-full shadow-lg transition duration-150 ease-in-out">
                    Install in your mobile
                </button>
            </div>
        </div>
        
    </div>

    <script>
        // --- RAW MESSAGE DATA (Simulating a single text file input) ---
        //
        // FORMAT:
        // 1. Title must be on the first line.
        // 2. Author must be on the last line, prefixed with "— " (em dash and space).
        // 3. Messages must be separated by the unique delimiter: ---MESSAGE END---
        // 4. Use double newlines (\n\n) for paragraphs in the body.
        //
        const rawMessageData = `
Messages from Kriya Yoga Masters
Breath control is self-control. Breath mastery is self-mastery. Breathlessness stage is deathlessness stage.
— Paramahamasa Hariharananda
---MESSAGE END---
The Discipline of Daily Practice
The greatest achievements are often the result of small, consistent efforts made daily. Do not seek drastic changes overnight; instead, focus on incremental improvements.

A single drop of water is insignificant, but the relentless consistency of rain carves canyons. Today, identify one small, positive habit and commit to repeating it without fail.
— The Masters
---MESSAGE END---
Stillness: The Path to Inner Clarity
In a world demanding constant motion, stillness is a revolutionary act. Take a moment today to consciously unhook from the relentless rush of activity.

Find five minutes of silence, not to plan or worry, but simply to observe your breath and the world around you. This deliberate pause recharges your inner resources and allows intuition to surface, guiding you with clarity you cannot find in haste.
— Kriya Master
---MESSAGE END---
The Secret of Creative Focus
Creativity is not reserved for artists; it is the fundamental human ability to solve problems and see possibilities where none existed before. Today, apply a creative lens to the most mundane task on your list. How can you approach it differently?

The Master knows that innovation is born from curiosity, not obligation. Unleash your unique perspective and watch the ordinary transform.
— The Inner Voice
---MESSAGE END---
`;

        // --- Global State and DOM Elements ---
        let localArticles = [];
        let currentArticleIndex = 0;
        const articleTitleDiv = document.getElementById('article-title');
        const articleBodyDiv = document.getElementById('article-body');
        const articleAuthorDiv = document.getElementById('article-author'); 
        const errorMessageDiv = document.getElementById('error-message');
        const installButton = document.getElementById('install-button');

        // --- Data Parsing Function (Replaces JSON parsing) ---
        function parseRawData(rawData) {
            const articles = [];
            
            // 1. Split the raw data by the unique delimiter, cleaning up extra whitespace/newlines
            const rawMessages = rawData.split('---MESSAGE END---')
                                       .map(msg => msg.trim())
                                       .filter(msg => msg.length > 0);

            rawMessages.forEach(rawMsg => {
                const lines = rawMsg.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                if (lines.length >= 2) {
                    const title = lines[0];
                    let author = '';
                    let bodyLines = lines.slice(1);
                    
                    // Check if the last line is the author (starts with '— ')
                    if (lines[lines.length - 1].startsWith('— ')) {
                        author = lines[lines.length - 1];
                        bodyLines = lines.slice(1, -1);
                    }

                    // Rejoin body lines, preserving double newlines for paragraphs
                    const body = bodyLines.join('\n'); // Single newline separates lines within a paragraph
                    
                    articles.push({ title, body, author });
                }
            });
            
            return articles;
        }

        // --- Utility function for deterministic selection (same article all day) ---
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash |= 0; 
            }
            return Math.abs(hash); 
        }

        // --- Core Functions ---

        function initializeIndex() {
            const date = new Date();
            // YYYYMMDD string for deterministic hashing
            const dateStringHash = `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;
            const hash = simpleHash(dateStringHash);
            
            if (localArticles.length === 0) return -1;

            // Selects a unique article based on the date
            currentArticleIndex = hash % localArticles.length;
            return currentArticleIndex;
        }
        
        function displayArticle(index) {
            if (index < 0 || index >= localArticles.length) {
                articleBodyDiv.innerHTML = '';
                errorMessageDiv.classList.remove('hidden');
                return;
            }
            
            const article = localArticles[index];
            
            articleTitleDiv.textContent = article.title;
            
            // Render the body, splitting by double newline to form paragraphs
            articleBodyDiv.innerHTML = article.body.split('\n\n').map(p => `<p class="mb-4">${p}</p>`).join('');

            articleAuthorDiv.textContent = article.author || '';

            articleBodyDiv.classList.remove('hidden');
            errorMessageDiv.classList.add('hidden');
        }

        // --- PWA INSTALLATION LOGIC ---
        
        let deferredPrompt; 
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Only show button if prompt is available
            installButton.classList.remove('hidden'); 

            installButton.addEventListener('click', () => {
                installButton.classList.add('hidden');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log(`Install prompt outcome: ${choiceResult.outcome}`);
                    deferredPrompt = null;
                });
            });
        });
        
        window.addEventListener('appinstalled', () => {
            installButton.classList.add('hidden');
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load and display the content
            localArticles = parseRawData(rawMessageData);

            if (localArticles.length > 0) {
                initializeIndex();
                displayArticle(currentArticleIndex);
            } else {
                errorMessageDiv.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
